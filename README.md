<<<<<<< HEAD
# tstv
Placeholder
=======
# Тестовое задание: Файловое хранилище с метаданными

## Описание проекта
Необходимо создать REST API сервис для управления файлами в системе электронного документооборота. Сервис должен обеспечивать загрузку файлов, автоматическое извлечение метаданных, управление доступом на основе ролей пользователей и уровней видимости файлов.

## Время выполнения: 3-5 дней

## Стек технологий:
- FastAPI
- SQLAlchemy
- Celery
- Redis
- Docker
- PostgreSQL

## Система ролей и доступов
### Концепция
Система должна использовать простую модель доступа без сложных персональных разрешений:
- Роли пользователей определяют возможности в системе
- Уровни видимости файлов определяют кто может видеть файл
- Отделы группируют пользователей для совместной работы

### Роли пользователей (3 роли)
1.  **USER** - Обычный пользователь
    *   **Возможности:**
        *   Загружать файлы до 10MB
        *   Создавать только приватные файлы
        *   Удалять только свои файлы
        *   Видеть публичные файлы и файлы своего отдела
    *   **Ограничения:**
        *   Не может создавать публичные файлы
        *   Не может создавать файлы для всего отдела
        *   Не может видеть файлы других отделов
        *   Типы файлов: только PDF

2.  **MANAGER** - Менеджер отдела
    *   **Возможности:**
        *   Загружать файлы до 50MB
        *   Создавать файлы любого уровня видимости
        *   Видеть файлы всех отделов
        *   Удалять файлы своего отдела
        *   Любые типы файлов

3.  **ADMIN** - Системный администратор
    *   **Возможности:**
        *   Загружать файлы до 100MB
        *   Полный доступ ко всем файлам
        *   Управление всеми пользователями
        *   Удаление любых файлов
        *   Любые типы файлов

### Уровни видимости файлов (3 уровня)
1.  **PRIVATE** - Приватный файл
    *   **Кто видит:**
        *   Только владелец файла
        *   Администраторы

2.  **DEPARTMENT** - Файл для отдела
    *   **Кто видит:**
        *   Все сотрудники того же отдела
        *   Менеджеры всех отделов (межотдельное сотрудничество)
        *   Администраторы

3.  **PUBLIC** - Публичный файл
    *   **Кто видит:**
        *   Все пользователи системы

## Авторизация
Использовать JWT авторизацию

## API Endpoints
-   **Аутентификация**
    -   `POST /auth/login` # Вход в систему
    -   `GET /auth/me` # Информация о текущем пользователе
    -   `POST /auth/create-admin` # Создание первого администратора (без аутентификации)

-   **Управление файлами**
    -   `POST /files/upload` # Загрузка файла
    -   `GET /files/{file_id}` # Информация о файле
    -   `GET /files/{file_id}/download` # Скачивание файла
    -   `DELETE /files/{file_id}` # Удаление файла
    -   `GET /files/` # Список доступных файлов

-   **Управление пользователями (только для менеджеров/админов)**
    -   `POST /users/` # Создание пользователя
    -   `GET /users/{user_id}` # Информация о пользователе
    -   `PUT /users/{user_id}/role` # Изменение роли пользователя
    -   `GET /users/` # Список пользователей отдела

## Функциональные требования
### 1. Управление файлами
#### Загрузка файлов
-   Загрузка файлов через REST API (multipart/form-data)
-   **Обязательные параметры при загрузке:**
    -   `file` - сам файл
    -   `visibility` - уровень видимости (private/department/public)
-   **Автоматические действия:**
    -   Проверка прав на создание файла с выбранной видимостью
    -   Валидация размера и типа файла согласно роли
    -   Автоматическое наследование отдела от владельца
    -   Запуск асинхронного извлечения метаданных
-   **Поддерживаемые форматы:**
    -   Документы: PDF, DOC, DOCX
-   Максимальный размер файла: 100MB
-   Автоматическое сохранение в файловую систему S3

#### Скачивание и просмотр
-   Скачивание файлов по ID с автоматической проверкой доступа
-   Получение метаданных файла
-   Список доступных файлов с фильтрацией по отделам
-   Отслеживание количества скачиваний

### 2. Автоматическое извлечение метаданных
Метаданные должны извлекаться асинхронно через Celery:
-   **Для PDF документов:**
    -   Количество страниц
    -   Автор документа
    -   Заголовок
    -   Дата создания
    -   Программа создания
-   **Для DOC/DOCX:**
    -   Количество параграфов
    -   Количество таблиц
    -   Заголовок документа
    -   Автор
    -   Дата создания

## Технические требования
-   Использовать асинхронный FastAPI + SQLAlchemy
-   Автоматическая миграция через Alembic
-   База данных: PostgreSQL
-   Технологии: Celery, Redis, S3 (MinIO)
-   Контейнеризация: проект должен быть полностью поднят через `docker compose up`
-   Должен быть файл `README.md` с инструкцией по запуску (1-2 команды)
-   API документация: Swagger/OpenAPI
-   Docstring

## Что нужно предоставить
-   Ссылка на репозиторий GitHub/GitLab
-   Код должен быть аккуратно оформлен, придерживаться PEP-8, использовать линтеры и форматировщики
-   Проект должен быть работоспособен по команде `docker compose up --build`
-   Срок выполнения 5 дней
>>>>>>> 7af2193 (Initial commit: Document Management System API)
